<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈†tefanov Chat</title>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f0f2f5; display: flex; flex-direction: column; height: 100vh; }
        .hlavicka { background-color: #0084ff; color: white; padding: 15px; text-align: center; font-weight: bold; }
        #chat-okno { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #e5ddd5; }
        .sprava { max-width: 75%; padding: 10px 15px; border-radius: 15px; font-size: 0.9em; }
        .odoslana { background-color: #dcf8c6; align-self: flex-end; color: black; border: 1px solid #ced4da; }
        .prijata { background-color: white; align-self: flex-start; color: black; border: 1px solid #ced4da; }
        .pisanielista { background-color: white; padding: 10px; display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        button { background-color: #0084ff; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }
    </style>
</head>
<body>
<button id="test-notifikacia" style="padding: 10px; margin: 20px;">
  Otestova≈• p√≠pnutie
</button>

    <div class="hlavicka" id="hlavicka">≈†tefanov Messenger üîî</div>
    <div style="text-align:center; font-size: 0.7em; color: gray;" id="stav-zvuku">Zvuk: Klikni na li≈°tu pre aktiv√°ciu</div>
    <div id="chat-okno"></div>
    <div class="pisanielista">
        <input type="text" id="vstup" placeholder="Nap√≠≈° spr√°vu...">
        <button id="tlacidloPoslat">Posla≈•</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAdhUJoq7szgFbp8WN5bTKx3Ib6OR8Oh5o",
            authDomain: "stefanov-chat.firebaseapp.com",
            projectId: "stefanov-chat",
            storageBucket: "stefanov-chat.firebasestorage.app",
            messagingSenderId: "915409159507",
            appId: "1:915409159507:web:d4fade5388b7822968cda6"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const spravyRef = collection(db, "spravy");

        const zvuk = new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3');
        let menoUzivatela = prompt("Zadaj svoje meno:") || "Hos≈•";
        let prveNacitanie = true;

        // ODOMKNUTIE ZVUKU
        document.getElementById('hlavicka').onclick = () => {
            zvuk.play().then(() => {
                zvuk.pause();
                document.getElementById('stav-zvuku').innerText = "Zvuk: ‚úÖ AKT√çVNY";
                document.getElementById('stav-zvuku').style.color = "green";
            });
        };

        async function poslatSpravu() {
            const vstup = document.getElementById('vstup');
            if (vstup.value.trim() !== "") {
                await addDoc(spravyRef, {
                    text: vstup.value,
                    cas: Date.now(),
                    autor: menoUzivatela 
                });
                vstup.value = "";
            }
        }

        document.getElementById('tlacidloPoslat').onclick = poslatSpravu;

        const q = query(spravyRef, orderBy("cas", "asc"));
        onSnapshot(q, (snapshot) => {
            const okno = document.getElementById('chat-okno');
            
            // Logika p√≠pnutia
            if (!prveNacitanie) {
                snapshot.docChanges().forEach(zmena => {
                    if (zmena.type === "added") {
                        const d = zmena.doc.data();
                        if (d.autor !== menoUzivatela) {
                            zvuk.play().catch(() => console.log("Klikni na li≈°tu!"));
                        }
                    }
                });
            }

            okno.innerHTML = ""; 
            snapshot.forEach((doc) => {
                const data = doc.data();
                const div = document.createElement('div');
                div.classList.add('sprava', data.autor === menoUzivatela ? 'odoslana' : 'prijata');
                div.innerHTML = `<b>${data.autor}</b><br>${data.text}`;
                okno.appendChild(div);
            });
            okno.scrollTop = okno.scrollHeight;
            prveNacitanie = false;
        });
    </script> 
    if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/-tefanovChat/firebase-messaging-sw.js')
    .then((registration) => {
      console.log('Service Worker zaregistrovan√Ω s rozsahom:', registration.scope);
    })
    .catch((err) => {
      console.log('Registr√°cia Service Workera zlyhala:', err);
    });
}
function poziadatOPovolenie() {
  Notification.requestPermission().then((permission) => {
    if (permission === 'granted') {
      console.log('Povolenie udelen√©!');
      // Tu nesk√¥r prid√°me z√≠skanie FCM tokenu
    } else {
      console.log('Povolenie zamietnut√©.');
    }
  });
}

// Spusti≈• pri naƒç√≠tan√≠ alebo po kliknut√≠ na nejak√© tlaƒçidlo
poziadatOPovolenie();
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-messaging.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAdhUJoq7szgFbp8WN5bTKx3Ib6OR8Oh5o",
    authDomain: "stefanov-chat.firebaseapp.com",
    projectId: "stefanov-chat",
    storageBucket: "stefanov-chat.firebasestorage.app",
    messagingSenderId: "915409159507",
    appId: "1:915409159507:web:6150b7b7b91e665d68cda6",
    measurementId: "G-X85J08SH6N"
  };

  const app = initializeApp(firebaseConfig);
  const messaging = getMessaging(app);

  async function requestPermission() {
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      // TU POZOR: Mus√≠≈° si v konzole vygenerova≈• VAPID kƒæ√∫ƒç a vlo≈æi≈• ho ni≈æ≈°ie
      const token = await getToken(messaging, { 
        vapidKey: 'TU_VLOZ_SVOJ_VYGENEROVANY_VAPID_KEY' 
      });
      if (token) {
        console.log('Token pre notifik√°cie:', token);
      }
    }
  }

  requestPermission();

  onMessage(messaging, (payload) => {
    console.log('Spr√°va v popred√≠:', payload);
    new Notification(payload.notification.title, {
      body: payload.notification.body,
    });
  });
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-messaging.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAdhUJoq7szgFbp8WN5bTKx3Ib6OR8Oh5o",
    authDomain: "stefanov-chat.firebaseapp.com",
    projectId: "stefanov-chat",
    storageBucket: "stefanov-chat.firebasestorage.app",
    messagingSenderId: "915409159507",
    appId: "1:915409159507:web:6150b7b7b91e665d68cda6",
    measurementId: "G-X85J08SH6N"
  };

  const app = initializeApp(firebaseConfig);
  const messaging = getMessaging(app);

  async function requestPermission() {
    console.log('≈Ωiadam o povolenie...');
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      try {
        const token = await getToken(messaging, { 
          // Tvoj VAPID kƒæ√∫ƒç z obr√°zka ƒç. 7
          vapidKey: 'BCy_i9AqhWKotoD5YUzkYWLEo-Std0VmwirSELJjuhdCM7CjVpsfv2tTkdm8vB9SBNU1zwsp-XSsC9Q0SQ1kYY' 
        });
        if (token) {
          console.log('Token z√≠skan√Ω:', token);
          // Tu ho nesk√¥r po≈°leme na tvoj Flask server
        }
      } catch (err) {
        console.log('Chyba pri z√≠skavan√≠ tokenu:', err);
      }
    }
  }

  requestPermission();

  onMessage(messaging, (payload) => {
    console.log('Spr√°va pri≈°la (v popred√≠):', payload);
    new Notification(payload.notification.title, {
      body: payload.notification.body,
      icon: 'https://cdn-icons-png.flaticon.com/512/5968/5968771.png'
    });
  });
</script>

</body>import { getMessaging, getToken } from "firebase/messaging";
import { getFirestore, doc, setDoc } from "firebase/firestore";

const db = getFirestore();
const messaging = getMessaging();

// Funkcia, ktor√° z√≠ska token a prirad√≠ ho k tvojmu menu
async function zaregistrujPrijemcu(menoPouzivatela) {
  try {
    const currentToken = await getToken(messaging, { 
      vapidKey: 'TU_VLOZ_SVOJ_VAPID_KƒΩ√öƒå_Z_FIREBASE_KONZOLY' 
    });

    if (currentToken) {
      console.log("Token z√≠skan√Ω:", currentToken);
      
      // Ulo≈æ√≠me token do Firestore pod tvoj√≠m menom
      await setDoc(doc(db, "pouzivatelia", menoPouzivatela), {
        fcmToken: currentToken,
        poslednaAktualizacia: new Date()
      }, { merge: true });
      
      alert("Notifik√°cie s√∫ akt√≠vne pre: " + menoPouzivatela);
    } else {
      alert("Nepodarilo sa z√≠ska≈• povolenie na notifik√°cie.");
    }
  } catch (err) {
    console.error("Chyba pri registr√°cii:", err);
  }
}

</html>
